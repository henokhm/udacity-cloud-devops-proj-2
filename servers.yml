Description: >
  Henok Hailemariam
  Udacity Cloud DevOps Engineer Nanodegree
  Project 2: Deploying a High Availability Web App using CloudFormation
  11 September 2020

  The network.yml CloudFormation script in the same directory deploys a VPC,
  with two public and two private subnets. On top of that infrastructure, this
  template deploys two Web Servers in each of the two private subnets.
  Each server is associated with an EBS volume. This script also adds an 
  application load balancer infront of the servers. It also creates a Bastion host
  in a public subnet.

Parameters:
  EnvironmentName:
    Description: An environment name that will be prefixed to resource names
    Type: String

Resources:
  LBSecGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Allow http to our load balancer
      VpcId:
        Fn::ImportValue: !Sub "${EnvironmentName}-VPCID"
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          CidrIp: 0.0.0.0/0
      SecurityGroupEgress:
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          CidrIp: 0.0.0.0/0
  WebServerSecGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Allow http to our hosts and SSH from local only
      VpcId:
        Fn::ImportValue: !Sub "${EnvironmentName}-VPCID"
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 8080
          ToPort: 8080
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          CidrIp: 0.0.0.0/0
      # - IpProtocol: tcp
      #   FromPort: 22
      #   ToPort: 22
      #   CidrIp: 0.0.0.0/0
      SecurityGroupEgress:
        - IpProtocol: tcp
          FromPort: 0
          ToPort: 65535
          CidrIp: 0.0.0.0/0
# Sample UserData
#  #!/bin/bash
#  apt-get update -y
#  apt-get install apache2 -y
#  systemctl start apache2.service
#  cd /var/www/html
#  echo "Udacity Demo Web Server Up and Running!" > index.html

# Outputs:

# TODO: add URL of the load balancer to output
